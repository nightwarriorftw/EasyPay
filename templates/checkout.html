{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}

  <main >
    <div class="container wow fadeIn">
      <h2 class="my-5 h2 text-center">Checkout form</h2>
      <div class="row">
        <div class="col-md-8 mb-4">
          <div class="card">              
              	<div id="my_camera"></div>
                <form method="POST">
                <input type=button value="Configure" onClick="configure()">
                <input type=button value="Take Snapshot" onClick="take_snapshot()">
                <input type=button value="Save Snapshot" onClick="saveSnap()">
 
                <div id="results" ></div>


              <div class="md-form mb-5">
              <br>
                  <span id='customer_name' name='customer_name'>{{form}}</span>
              </div> 

              <form method="POST" class="card-body">
                {% csrf_token %}
              <hr class="mb-4">
              <button class="btn btn-primary btn-lg btn-block" type="submit">Continue to checkout</button>

              </form>

          </div>

        </div>

        {% comment %} <div class="col-md-4 mb-4">
          {% include "order_snippet.html" %}
        </div> {% endcomment %}

      </div>

    </div>
  </main>

{% endblock content %}

{% block extra_scripts %}
<script type="text/javascript" src="{% static 'js/webcam.min.js' %}"></script>
<script>
 
 // Configure a few settings and attach camera
 function configure(){
  Webcam.set({
   width: 320,
   height: 240,
   image_format: 'jpeg',
   jpeg_quality: 90
  });
  Webcam.attach( '#my_camera' );
 }
 // A button for taking snaps

 function take_snapshot() {
  // take snapshot and get image data
  Webcam.snap( function(data_uri) {
  // display results in page
  document.getElementById('results').innerHTML = 
   '<img id="imageprev" src="'+data_uri+'"/>';
  } );

  Webcam.reset();
 }

function saveSnap(){
 // Get base64 value from <img id='imageprev'> source
 axios.defaults.xsrfCookieName = 'csrftoken'
 axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
 var base64image = document.getElementById("imageprev").src;
  console.log(base64image);
 Webcam.upload( base64image, "{% url 'core:checkout' %}", function(status, response) {
  console.log(response);
  console.log(statuc);
 });

}
</script>
{% endblock extra_scripts %}
