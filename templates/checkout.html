{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}

  <main >
    <div class="container wow fadeIn">
      <h2 class="my-5 h2 text-center">Checkout form</h2>
      <div class="row">
        <div class="col-md-8 mb-4">
          <div class="card">              
              	<div id="my_camera"></div>
                <form method="POST">
                <input type=button value="Configure" onClick="configure()">
                <input type=button value="Take Snapshot" onClick="take_snapshot()">
                <input type=button value="Send" id="startProcessing">

                <div id="results"></div>

                <input type="file" name="uploadImage" id="uploadImage" />

              <div class="md-form mb-5">
              <br>
              <br>
                  <span id='customer_name' name='customer_name'>{{form}}</span>
              </div> 

              <form method="POST" class="card-body">
                {% csrf_token %}
              <hr class="mb-4">
              <button class="btn btn-primary btn-lg btn-block" type="submit">Continue to checkout</button>

              </form>

          </div>

        </div>

        {% comment %} <div class="col-md-4 mb-4">
          {% include "order_snippet.html" %}
        </div> {% endcomment %}

      </div>

    </div>
  </main>

{% endblock content %}

{% block extra_scripts %}
<script type="text/javascript" src="{% static 'js/webcam.min.js' %}"></script>
<script>
 
 // Configure a few settings and attach camera
 function configure(){
  Webcam.set({
   width: 320,
   height: 240,
   image_format: 'jpeg',
   jpeg_quality: 90
  });
  Webcam.attach( '#my_camera' );
 }

// function to convert DataURI to Blob
function dataURItoBlob(dataURI) {
    // convert base64/URLEncoded data component to raw binary data held in a string
    var byteString;
    if (dataURI.split(',')[0].indexOf('base64') >= 0)
        byteString = atob(dataURI.split(',')[1]);
    else
        byteString = unescape(dataURI.split(',')[1]);

    // separate out the mime component
    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

    // write the bytes of the string to a typed array
    var ia = new Uint8Array(byteString.length);
    for (var i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }

    return new Blob([ia], {type:mimeString});
}

 // A button for taking snaps
 function take_snapshot() {
  // take snapshot and get image data
  Webcam.snap( function(data_uri) {
  // display results in page
  document.getElementById('results').innerHTML = '<img src="'+data_uri+'" id="clickedImage">'
  //let blob = dataURItoBlob(data_uri);
  //console.log(blob);
  });

  Webcam.reset();
 }
</script>

<script deref src="{% static 'js/face-api.min.js' %}"></script>
<script deref src="{% static 'js/script.js' %}"></script>

{% endblock extra_scripts %}
